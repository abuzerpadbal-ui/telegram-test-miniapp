<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<title>ğŸ‘‘ Admin Test Builder</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  body { font-family: Arial; background: #f0f8ff; padding: 15px; }
  h2 { text-align: center; color: #2a2a72; }
  input, textarea, button { width: 100%; padding: 10px; margin: 6px 0; border-radius: 5px; }
  .question-box { background: #fff; padding: 15px; margin: 12px 0; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1);}
  .option { display: flex; gap: 5px; margin-bottom: 5px; }
  .option input[type="text"] { flex: 1; }
  button { background: #4caf50; color: #fff; border: none; cursor: pointer; font-weight: bold; }
  button:hover { background: #45a049; }
</style>
</head>
<body>
<h2>ğŸ‘‘ Admin Test Yaratish</h2>

<div id="step1">
  <input id="testCode" placeholder="Test kodi (masalan SAT123)">
  <input id="questionCount" type="number" placeholder="Nechta savol?" min="1">
  <button onclick="startTest()">â¡ï¸ Keyingi</button>
</div>

<div id="questions"></div>

<button id="finishBtn" style="display:none;" onclick="finishTest()">âœ… Testni saqlash</button>

<script>
Telegram.WebApp.ready();

let test = { role: "admin", test_code: "", questions: [] };
let totalQuestions = 0;
let currentQuestion = 0;

function startTest() {
  const code = document.getElementById("testCode").value.trim();
  const count = parseInt(document.getElementById("questionCount").value);
  if(!code || !count){ alert("Kod va savollar sonini kiriting"); return; }

  test.test_code = code;
  totalQuestions = count;
  document.getElementById("step1").style.display = "none";
  createQuestion();
}

function createQuestion() {
  currentQuestion++;
  const box = document.createElement("div");
  box.className = "question-box";

  box.innerHTML = `
    <h3>ğŸ“Œ Savol ${currentQuestion}</h3>
    <textarea placeholder="Savol matni"></textarea>
    <div class="option"><input placeholder="A variant"><input type="checkbox"> Toâ€˜gâ€˜ri</div>
    <div class="option"><input placeholder="B variant"><input type="checkbox"> Toâ€˜gâ€˜ri</div>
    <div class="option"><input placeholder="C variant"><input type="checkbox"> Toâ€˜gâ€˜ri</div>
    <div class="option"><input placeholder="D variant"><input type="checkbox"> Toâ€˜gâ€˜ri</div>
    <div class="option"><input placeholder="E variant"><input type="checkbox"> Toâ€˜gâ€˜ri</div>
    <textarea placeholder="âœï¸ Yozma javob (ixtiyoriy)"></textarea>
    <button onclick="saveQuestion(this)">ğŸ’¾ Saqlash</button>
  `;

  document.getElementById("questions").appendChild(box);
}

function saveQuestion(btn) {
  const box = btn.parentElement;
  const inputs = box.querySelectorAll("input[type='text']");
  const checks = box.querySelectorAll("input[type='checkbox']");
  const textareas = box.querySelectorAll("textarea");

  let options=[], correct=[];
  inputs.forEach((inp,i)=>{ if(inp.value.trim()){ options.push(inp.value.trim()); if(checks[i].checked) correct.push(inp.value.trim()); } });

  test.questions.push({
    question: textareas[0].value,
    options: options,
    correct: correct,
    written: textareas[1].value
  });

  btn.disabled = true; btn.innerText="âœ” Saqlandi";

  if(currentQuestion < totalQuestions) createQuestion();
  else document.getElementById("finishBtn").style.display="block";
}

function finishTest() {
  Telegram.WebApp.sendData(JSON.stringify(test));
  Telegram.WebApp.close();
}
</script>
</body>
</html>
