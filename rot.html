<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<title>Test ishlash</title>
<style>
body {
  font-family: Arial;
  background: #020617;
  color: white;
  padding: 20px;
}
.box {
  max-width: 600px;
  margin: auto;
}
button, input {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
}
</style>
</head>
<body>

<div class="box">
  <h2>üßë‚Äçüéì Test ishlash</h2>

  <input id="fname" placeholder="Ism">
  <input id="lname" placeholder="Familiya">
  <input id="code" placeholder="Test kodi">

  <button onclick="loadTest()">Boshlash</button>

  <div id="test"></div>
</div>

<script>
let testData;

async function loadTest() {
  const code = document.getElementById("code").value;
  const res = await fetch("http://127.0.0.1:5000/client/get_test/" + code);

  if (!res.ok) {
    alert("Test topilmadi");
    return;
  }

  testData = await res.json();
  showTest();
}

function showTest() {
  let html = "";
  testData.questions.forEach((q, i) => {
    html += `<p>${i+1}. ${q.question}</p>`;
    q.options.forEach((o, idx) => {
      html += `
        <label>
          <input type="radio" name="q${i}" value="${idx}">
          ${o}
        </label><br>`;
    });
  });
  html += `<button onclick="finish()">Yakunlash</button>`;
  document.getElementById("test").innerHTML = html;
}

function finish() {
  let score = 0;
  testData.questions.forEach((q, i) => {
    const ans = document.querySelector(`input[name="q${i}"]:checked`);
    if (ans && Number(ans.value) === q.answer) score++;
  });

  alert(`Natija: ${score} / ${testData.questions.length}`);
}
</script>

</body>
</html>
