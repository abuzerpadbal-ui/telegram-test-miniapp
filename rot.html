<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body { font-family: Arial; background:#f2f4ff; }
.container { max-width:800px; margin:auto; background:#fff; padding:20px; border-radius:12px; }
button,input { width:100%; padding:10px; margin:6px 0; }
.variants button { width:48%; margin:4px 1%; }
.active { background:#4caf50; color:white; }
</style>
</head>

<body>
<div class="container">
<h2>ðŸ›  Admin test yaratish</h2>

<div id="step1">
  <input id="code" placeholder="Test kodi (masalan: 20)">
  <input id="count" type="number" placeholder="Savollar soni">
  <button onclick="start()">Boshlash</button>
</div>

<div id="step2" style="display:none">
  <h3 id="title"></h3>

  <div class="variants">
    <button onclick="pick('A')">A</button>
    <button onclick="pick('B')">B</button>
    <button onclick="pick('C')">C</button>
    <button onclick="pick('D')">D</button>
    <button onclick="pick('E')">E</button>
  </div>

  <input id="written" placeholder="Yozma javob (masalan: 2 va 3)">
  <button onclick="next()">Keyingi</button>
</div>
</div>

<script>
const tg = Telegram.WebApp;
tg.expand();

let testCode="", total=0, cur=0, questions=[], variant=null;

function start(){
  testCode = code.value.trim();
  total = +count.value;
  if(!testCode || !total) return alert("Toâ€˜ldir!");
  step1.style.display="none";
  step2.style.display="block";
  show();
}

function show(){
  title.innerText = `Savol ${cur+1} / ${total}`;
  written.value="";
  variant=null;
  document.querySelectorAll(".variants button").forEach(b=>b.classList.remove("active"));
}

function pick(v){
  variant=v;
  document.querySelectorAll(".variants button").forEach(b=>{
    b.classList.toggle("active", b.innerText===v);
  });
}

function next(){
  const raw = written.value;
  const arr = raw ? raw.split("va").map(x=>x.trim()).filter(Boolean) : [];

  questions.push({
    variant: variant,
    written_answers: arr
  });

  cur++;
  cur>=total ? finish() : show();
}

function finish(){
  tg.sendData(JSON.stringify({
    role:"admin",
    test_code:testCode,
    questions:questions
  }));
  tg.close();
}
</script>
</body>
</html>
