<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Foydalanuvchi Test Panel</title>
<style>
body { font-family: Arial, sans-serif; background: #f4f6ff; }
.container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 10px; }
.hidden { display: none; }
input, button { padding: 10px; margin: 5px 0; width: 100%; }
.variants button { width: 48%; margin: 3px 1%; }
.active { background: #4caf50; color: white; }
.disabled { opacity: 0.5; pointer-events: none; }
.result { background: #e3f2fd; padding: 10px; margin-top: 10px; border-radius: 5px; }
.correct { color: green; font-weight: bold; }
.wrong { color: red; font-weight: bold; }
</style>
</head>
<body>

<div class="container">

<h2>Testni boshlaymiz</h2>

<div id="questionPanel">
  <h3 id="qTitle"></h3>

  <div class="variants">
    <button onclick="selectVariant('A')">A</button>
    <button onclick="selectVariant('B')">B</button>
    <button onclick="selectVariant('C')">C</button>
    <button onclick="selectVariant('D')">D</button>
    <button onclick="selectVariant('E')">E</button>
  </div>

  <input type="text" id="written" placeholder="Yozma javob (agar kerak bo‘lsa)" oninput="writtenInput()" />

  <button onclick="nextQuestion()">Keyingi savol</button>
</div>

<div id="resultPanel" class="hidden">
  <h3>Test natijalari</h3>
  <div id="results"></div>
</div>

</div>

<script>
// Bu yerga admin tomonidan yuborilgan test ma'lumotlari o'rnatiladi
// Misol uchun:
let adminTest = [
  { variant: "B", written: "" },
  { variant: "A", written: "2 va 3" },
  { variant: null, written: "Xatolik va To'g'ri" }
];

let total = adminTest.length;
let current = 0;
let userAnswers = [];
let selectedVariant = null;

function showQuestion() {
  document.getElementById("qTitle").innerText = `Savol ${current + 1} / ${total}`;
  document.getElementById("written").value = "";
  enableVariants(true);
  selectedVariant = null;
}

function selectVariant(v) {
  selectedVariant = v;
  document.getElementById("written").disabled = true;
  highlightVariant(v);
}

function writtenInput() {
  const val = document.getElementById("written").value;
  if (val.length > 0) {
    enableVariants(false);
    selectedVariant = null;
    const parts = val.split(" va ").map(p => p.trim()).filter(p => p);
    document.getElementById("written").value = parts.join(" va ");
  } else {
    enableVariants(true);
  }
}

function enableVariants(enable) {
  document.querySelectorAll(".variants button").forEach(b => {
    b.classList.remove("active");
    b.disabled = !enable;
  });
  if (enable) document.getElementById("written").disabled = false;
}

function highlightVariant(v) {
  document.querySelectorAll(".variants button").forEach(b => {
    b.classList.remove("active");
    if (b.innerText === v) b.classList.add("active");
  });
}

function nextQuestion() {
  userAnswers.push({
    variant: selectedVariant,
    written: document.getElementById("written").value
  });

  current++;
  if (current >= total) {
    showResults();
  } else {
    showQuestion();
  }
}

function showResults() {
  document.getElementById("questionPanel").classList.add("hidden");
  document.getElementById("resultPanel").classList.remove("hidden");

  let resultsDiv = document.getElementById("results");
  resultsDiv.innerHTML = "";
  let score = 0;

  for (let i = 0; i < total; i++) {
    const adminAns = adminTest[i];
    const userAns = userAnswers[i];

    let variantCorrect = adminAns.variant === userAns.variant;
    let writtenCorrect = adminAns.written === userAns.written;

    if (variantCorrect || writtenCorrect) score++;

    resultsDiv.innerHTML += `<div class="result">
      <strong>Savol ${i+1}</strong><br>
      Admin javobi: ${adminAns.variant ? adminAns.variant : adminAns.written}<br>
      Sizning javobingiz: ${userAns.variant ? userAns.variant : userAns.written}<br>
      Holat: <span class="${variantCorrect || writtenCorrect ? 'correct' : 'wrong'}">
      ${variantCorrect || writtenCorrect ? '✅ To‘g‘ri' : '❌ Xato'}</span>
    </div>`;
  }

  resultsDiv.innerHTML += `<h3>Ballingiz: ${score} / ${total}</h3>`;
}

// Boshlash
showQuestion();
</script>

</body>
</html>
