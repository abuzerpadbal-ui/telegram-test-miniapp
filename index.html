<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“ Test</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Inter', sans-serif;
  background: linear-gradient(120deg,#eef3ff,#ffffff);
  margin: 0;
  padding: 20px;
}
.container {
  max-width: 700px;
  margin: auto;
  background: #fff;
  border-radius: 14px;
  padding: 25px;
  box-shadow: 0 10px 30px rgba(0,0,0,.1);
}
h2 { margin-top: 0; color:#2563eb; }
.progress {
  font-weight: 600;
  margin-bottom: 15px;
}
.variant {
  border:1px solid #ddd;
  border-radius:8px;
  padding:12px;
  margin-bottom:10px;
  cursor:pointer;
}
.variant.active {
  background:#2563eb;
  color:#fff;
  border-color:#2563eb;
}
textarea {
  width:100%;
  padding:12px;
  border-radius:8px;
  border:1px solid #ccc;
  resize:none;
}
button {
  width:100%;
  padding:14px;
  margin-top:15px;
  border:none;
  border-radius:10px;
  background:#2563eb;
  color:#fff;
  font-size:16px;
  cursor:pointer;
}
button:hover { background:#1e40af; }
.hidden { display:none; }
</style>
</head>

<body>
<div class="container">

  <!-- KOD PANEL -->
  <div id="codePanel">
    <h2>ğŸ” Test kodi</h2>
    <input id="testCode" type="number" placeholder="Test kodini kiriting" style="width:100%;padding:12px;border-radius:8px;border:1px solid #ccc">
    <button onclick="checkCode()">Boshlash</button>
  </div>

  <!-- TEST PANEL -->
  <div id="testPanel" class="hidden">
    <div class="progress" id="progress"></div>
    <h2 id="questionText"></h2>

    <div id="variants"></div>

    <textarea id="written"
      placeholder="Yozma javob..."
      rows="3"
      oninput="writtenTyped()"></textarea>

    <button onclick="nextQuestion()">Keyingi</button>
  </div>

</div>

<script>
let tests = JSON.parse(localStorage.getItem("adminTests")) || {};
let test = [];
let index = 0;
let score = 0;
let selected = null;

function checkCode() {
  const code = document.getElementById("testCode").value;
  if(!tests[code]) {
    alert("âŒ Notoâ€˜gâ€˜ri kod");
    return;
  }
  test = tests[code];
  document.getElementById("codePanel").classList.add("hidden");
  document.getElementById("testPanel").classList.remove("hidden");
  render();
}

function render() {
  const q = test[index];
  document.getElementById("progress").innerText =
    `${test.length} / ${index+1}`;
  document.getElementById("questionText").innerText =
    `Savol ${index+1}`;

  const box = document.getElementById("variants");
  box.innerHTML = "";
  selected = null;
  document.getElementById("written").value = "";
  document.getElementById("written").disabled = false;

  for (let k in q.variants) {
    if(q.variants[k]) {
      const d = document.createElement("div");
      d.className = "variant";
      d.innerText = `${k}) ${q.variants[k]}`;
      d.onclick = () => selectVariant(d, k);
      box.appendChild(d);
    }
  }
}

function selectVariant(el, key) {
  document.querySelectorAll(".variant").forEach(v => v.classList.remove("active"));
  el.classList.add("active");
  selected = key;
  document.getElementById("written").value = "";
  document.getElementById("written").disabled = true;
}

function writtenTyped() {
  if(document.getElementById("written").value.trim() !== "") {
    document.querySelectorAll(".variant").forEach(v => v.classList.remove("active"));
    selected = null;
  }
}

function nextQuestion() {
  const q = test[index];
  let ok = false;

  if(selected) {
    ok = q.correct.includes(selected);
  } else {
    const txt = document.getElementById("written").value.trim().toLowerCase();
    ok = q.correct.map(x=>x.toLowerCase()).includes(txt);
  }

  if(ok) score++;

  index++;
  if(index < test.length) {
    render();
  } else {
    finish();
  }
}

function finish() {
  const ball = Math.round(800 * score / test.length);
  let msg = `Test tugadi!\nBall: ${ball}/800\n`;

  if(ball >= 700) msg += "ğŸ‰ Tabriklaymiz!";
  else if(ball >= 300) msg += "ğŸ™‚ Yaxshi natija";
  else msg += "ğŸ˜” Afsus";

  alert(msg);
  location.reload();
}
</script>
</body>
</html>
