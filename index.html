<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<title>üìù Mijoz Test Mini App</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
  body { font-family: Arial; background: #fff8dc; padding: 15px; }
  h2 { text-align:center; color: #333399; }
  .question-box { background:#f0f0f0; padding:12px; margin:12px 0; border-radius:8px; }
  input[type="radio"], input[type="checkbox"] { margin-right:5px; }
  textarea { width:100%; padding:8px; margin:5px 0; border-radius:5px; }
  button { width:100%; padding:10px; margin:8px 0; background:#1e90ff; color:#fff; border:none; font-weight:bold; border-radius:5px; cursor:pointer; }
  button:hover { background:#1c86ee; }
  #progress { font-weight:bold; margin-bottom:10px; }
</style>
</head>
<body>
<h2>üìù Testni boshlash</h2>

<div id="start">
  <input id="testCode" placeholder="Test kodi (admindan olingan)">
  <button onclick="startTest()">‚û°Ô∏è Testni boshlash</button>
</div>

<div id="testArea" style="display:none">
  <div id="progress"></div>
  <div id="questionContainer"></div>
  <button id="nextBtn" onclick="nextQuestion()">‚û°Ô∏è Keyingi</button>
  <button id="finishBtn" style="display:none;" onclick="finishTest()">‚úÖ Testni tugatish</button>
</div>

<script>
Telegram.WebApp.ready();

let test = { role:"user", test_code:"", questions:[], answers:[] };
let currentQ = 0;

function startTest(){
  const code = document.getElementById("testCode").value.trim();
  if(!code){ alert("Test kodini kiriting"); return; }
  test.test_code = code;

  // Bu yerda admin botga JSON orqali testni olishini simulyatsiya qilamiz
  // Misol uchun testni shunday tayyorlaymiz:
  test.questions = [
    {question:"1-savol matni", options:["A1","B1","C1","D1","E1"], written:"javob1", correct:["B1"]},
    {question:"2-savol matni", options:["A2","B2","C2","D2","E2"], written:"", correct:["A2","C2"]}
  ];

  document.getElementById("start").style.display="none";
  document.getElementById("testArea").style.display="block";
  showQuestion();
}

function showQuestion(){
  const q = test.questions[currentQ];
  const container = document.getElementById("questionContainer");
  container.innerHTML = `<h3>üìå ${q.question}</h3>`;

  if(q.options.length){
    q.options.forEach((opt,i)=>{
      container.innerHTML += `<div><input type="checkbox" name="opt" value="${opt}"> ${opt}</div>`;
    });
  }

  container.innerHTML += `<textarea id="written" placeholder="‚úçÔ∏è Yozma javob (ixtiyoriy)">${q.written || ""}</textarea>`;

  document.getElementById("progress").innerText = `üìù Siz ${test.questions.length} ta savoldan ${currentQ+1}-savolga javob beryapsiz`;
}

function nextQuestion(){
  const q = test.questions[currentQ];
  let selected = [];
  document.querySelectorAll("input[name='opt']:checked").forEach(chk=> selected.push(chk.value));
  let written = document.getElementById("written").value;

  test.answers.push({selected, written});
  currentQ++;

  if(currentQ < test.questions.length){
    showQuestion();
  } else {
    document.getElementById("nextBtn").style.display="none";
    document.getElementById("finishBtn").style.display="block";
  }
}

function finishTest(){
  Telegram.WebApp.sendData(JSON.stringify(test));
  Telegram.WebApp.close();
}
</script>
</body>
</html>
