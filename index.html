<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üìù Mijoz Test Panel</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
body {
    font-family: 'Roboto', sans-serif;
    background: linear-gradient(120deg, #fff0f0, #ffe0e0);
    padding: 20px;
    color: #333;
}
.container {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}
h1 {
    text-align: center;
    color: #e91e63;
    margin-bottom: 25px;
}
label { font-weight: 500; }
input[type="text"] {
    width: 100%;
    padding: 10px;
    margin: 5px 0 15px;
    border-radius: 6px;
    border: 1px solid #ccc;
}
button {
    background-color: #e91e63;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    margin-top: 10px;
}
button:hover { background-color: #c2185b; }
.question-block { margin-top: 25px; border-top: 1px solid #ddd; padding-top: 20px; }
.variant-inputs { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
.variant-inputs label { font-weight: normal; }
.result { font-size: 18px; margin-top: 20px; text-align: center; }
</style>
</head>
<body>
<div class="container">
    <h1>üìù Mijoz Test Panel</h1>

    <!-- Start Panel -->
    <div id="startPanel">
        <label>Ismingizni kiriting:</label>
        <input type="text" id="firstName" placeholder="Ism">
        <label>Familiyangizni kiriting:</label>
        <input type="text" id="lastName" placeholder="Familiya">
        <button id="startBtn">üöÄ Testni boshlash</button>
    </div>

    <!-- Code Verification Panel -->
    <div id="codePanel" style="display:none;">
        <label>Admin tomonidan berilgan kodni kiriting:</label>
        <input type="text" id="accessCode" placeholder="Kod">
        <button id="verifyCodeBtn">‚úÖ Tasdiqlash</button>
    </div>

    <!-- Question Panel -->
    <div id="questionPanel" style="display:none;">
        <div class="question-counter">Savol 1</div>
        <div class="question-block">
            <div class="variant-inputs">
                <label><input type="radio" name="answer" value="A"> A</label>
                <label><input type="radio" name="answer" value="B"> B</label>
                <label><input type="radio" name="answer" value="C"> C</label>
                <label><input type="radio" name="answer" value="D"> D</label>
                <label><input type="radio" name="answer" value="E"> E</label>
            </div>
            <label>‚úç Yozma javob (agar bo‚Äòlsa):</label>
            <input type="text" id="writtenAnswer">

            <button id="nextQuestionBtn">‚û° Keyingi savol</button>
        </div>
    </div>

    <div id="resultPanel" style="display:none;">
        <div class="result" id="resultText"></div>
        <button id="restartBtn">üîÑ Testga qayta kirish</button>
    </div>
</div>

<script>
let testData = [];
let currentQuestion = 0;
let userAnswers = [];
let adminCode = '1234'; // Admin bu kodni localStorage dan olishi mumkin

// Start
document.getElementById('startBtn').addEventListener('click', () => {
    let fname = document.getElementById('firstName').value.trim();
    let lname = document.getElementById('lastName').value.trim();
    if(fname && lname){
        document.getElementById('startPanel').style.display = 'none';
        document.getElementById('codePanel').style.display = 'block';
    } else {
        alert('Iltimos, ism va familiyani kiriting!');
    }
});

// Verify code
document.getElementById('verifyCodeBtn').addEventListener('click', () => {
    let code = document.getElementById('accessCode').value.trim();
    let savedTest = JSON.parse(localStorage.getItem('adminTestData'));
    if(!savedTest || savedTest.length===0){
        alert('Admin hali test yaratmagan!');
        return;
    }
    if(code === adminCode){
        testData = savedTest;
        document.getElementById('codePanel').style.display = 'none';
        document.getElementById('questionPanel').style.display = 'block';
        loadQuestion();
    } else {
        alert('‚ùå Kod xato! To‚Äòg‚Äòri kodni kiriting.');
    }
});

// Load question
function loadQuestion(){
    if(currentQuestion >= testData.length){
        showResult();
        return;
    }
    const q = testData[currentQuestion];
    document.querySelector('.question-counter').innerText = `Savol ${currentQuestion+1}/${testData.length}`;
    let radios = document.getElementsByName('answer');
    radios.forEach(r => r.checked = false);
    document.getElementById('writtenAnswer').value = '';
    if(q.variants.A || q.variants.B || q.variants.C || q.variants.D || q.variants.E){
        // Show variants
        radios.forEach((r,i)=>{
            r.parentElement.style.display = ['A','B','C','D','E'][i] in q.variants ? 'block':'none';
            r.nextSibling.textContent = ` ${q.variants[['A','B','C','D','E'][i]]}`;
        });
    } else {
        radios.forEach(r => r.parentElement.style.display = 'none');
    }
}

// Next question
document.getElementById('nextQuestionBtn').addEventListener('click', ()=>{
    const q = testData[currentQuestion];
    let radios = document.getElementsByName('answer');
    let selected = Array.from(radios).find(r=>r.checked)?.value || '';
    let written = document.getElementById('writtenAnswer').value.trim();
    userAnswers.push({selected, written});
    currentQuestion++;
    loadQuestion();
});

// Show result
function showResult(){
    document.getElementById('questionPanel').style.display = 'none';
    document.getElementById('resultPanel').style.display = 'block';
    let total = testData.length;
    let correct = 0;
    for(let i=0;i<total;i++){
        const q = testData[i];
        let correctAns = (q.writtenAnswer || '').split(' va ').map(s=>s.trim());
        if(correctAns.includes(userAnswers[i].selected) || correctAns.includes(userAnswers[i].written)){
            correct++;
        }
    }
    // Ball hisoblash: 800 ballni test soniga bo‚Äòlish
    let ball = Math.round((800/total)*correct);
    let text = `‚úÖ Siz ${ball} ball oldingiz!`;
    if(ball>=700) text += ' üéâ Juda zo‚Äòr! Tabrigimiz!';
    else text += ' üòî Afsus, keyingi safar ko‚Äòproq harakat qiling!';
    text += ' üîÑ Agar testga qayta kirishni xohlasangiz, Start tugmasini bosing.';
    document.getElementById('resultText').innerText = text;
}

// Restart
document.getElementById('restartBtn').addEventListener('click', ()=>{
    location.reload();
});
</script>
</body>
</html>
